<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 5</title>
    <script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(1000, 750, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {
    game.load.image('background', 'assets/background.png');
    game.load.image('dude', 'assets/sgt animaltalker.png');
    game.load.image('tree', 'assets/tree.png');
    game.load.image('cup', 'assets/cometdoes.png');
    game.load.image('ground', 'assets/ground.png');
    game.load.image('squirrel', 'assets/killersquirrel.png');
    game.load.image('acorn', 'assets/acorn.png');
    game.load.image('arm', 'assets/arm.png');
}
    
var player;
var cursors;
var bullets;

var fireRate = .1;
var nextFire = 3;
var star;
var squirrels;
    
function create() {
    
    game.physics.startSystem(Phaser.Physics.ARCADE);
    game.physics.arcade.gravity.y=0
    
    game.add.image(0, 0, 'background');
    game.add.image(0, 650, 'ground');
    game.add.image(0, 110, 'tree');
    game.add.image(400, 600, 'cup');
    game.add.image(50, 100, 'squirrel');
    
    
    //collision test//
    
   bullets = game.add.group();
    bullets.enableBody = true;
    bullets.physicsBodyType = Phaser.Physics.ARCADE;

    bullets.createMultiple(100, 'acorn');
    bullets.setAll('checkWorldBounds', true);
    bullets.setAll('outOfBoundsKill', true);
    
    player = game.add.sprite(600, 600, 'dude');
    player.anchor.set(0.5);
    player.body.immovable = true;

    game.physics.enable(player, squirrels, Phaser.Physics.ARCADE);

    player.body.allowRotation = true;
    
    squirrels = game.add.sprite(700, 700, 'squirrel');
    squirrels.enableBody = true;
    squirrels.physicsBodyType = Phaser.Physics.ARCADE;
    squirrels.physicsBodyType.immovable = true; 
    
    
    star = game.add.image(400, 400, 'cup');
    star.enableBody = true;
    star.physicsBodyType = Phaser.Physics.ARCADE;
    
}
    

function update() {
    
 player.rotation += 0.01;
 player.rotation = game.physics.arcade.angleToPointer(player);
 this.physics.arcade.overlap(bullets, squirrels, collisionHandler);

    if (game.input.activePointer.isDown)
    {
        fire();
    }

}
    

    
    function fire() {

    if (game.time.now > nextFire && bullets.countDead() > 0)
    {
        nextFire = game.time.now + fireRate;

        var bullet = bullets.getFirstDead();

        bullet.reset(player.x - 8, player.y - 8);

        game.physics.arcade.moveToPointer(bullet, 300);
    }

}

function render() {

     game.debug.text('Active Bullets: ' + bullets.countLiving() + ' / ' + bullets.total, 32, 32);
    game.debug.spriteInfo(player, 32, 450);
    game.debug.spriteInfo(star, 32, 450); 
}

function processHandler (bullets, squirrels ) {

    return true;

}

function collisionHandler (squirrels, bullets, target) {

    {
        squirrels.kill();
    }

}
</script>

</body>
</html>