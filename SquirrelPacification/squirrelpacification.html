<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 5</title>
    <script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

<script type="text/javascript">

var game = new Phaser.Game(1000, 700, Phaser.AUTO, '', { preload: preload, create: create, update: update });

function preload() {
    game.load.image('background', 'assets/background.png');
    game.load.image('dude', 'assets/sgt animaltalker.png');
    game.load.image('tree', 'assets/tree.png');
    game.load.image('cup', 'assets/cometdoes.png');
    game.load.image('ground', 'assets/ground.png');
    game.load.image('squirrel', 'assets/evilSquirrel.png');
    game.load.image('acorn', 'assets/acorn1.png');
    game.load.image('arm', 'assets/arm.png');
    game.load.bitmapFont('eightbitwonder', 'fonts/eightbitwonder.png', 'fonts/eightbitwonder.fnt');
    
}
    
var player;
var cursors;
var bullets;

var fireRate = 100;
var nextFire = 3;
var star;
var squirrel;
var squirrels;
var squirrelGang;
var score = 0;
var scoreText;

    
    
function create() {
    
    game.physics.startSystem(Phaser.Physics.ARCADE);
    game.physics.arcade.gravity.y=0
    game.physics.arcade.gravity.y=13

    game.add.image(0, 0, 'background');
    game.add.image(0, 650, 'ground');
    game.add.image(0, 110, 'tree');
    
    //score//
    scoreText = game.add.text(16, 100, 'score: 0', { fontSize: '32px', fill: '#000'});
   
    
    star = game.add.sprite(100, 600, 'cup');
    game.physics.enable(star);
    star.enableBody = true;
    star.body.collideWorldBounds = true;
    
<<<<<<< HEAD
    squirrels = game.add.sprite(100, 300, 'squirrel');
    game.physics.enable(squirrels, Phaser.Physics.ARCADE);
    squirrels.enableBody = true;
     
    squirrels.physicsBodyType = Phaser.Physics.ARCADE;
    squirrels.physicsBodyType.immovable = true; 
    squirrels.body.collideWorldBounds = true;
    
    squirrelGang = game.add.group();
    
=======
 //   for (var i=0; i < totalSquirrels; i++) {
        squirrels = game.add.sprite(game.world.width, game.world.randomY, 'squirrel');
        game.physics.enable(squirrels, Phaser.Physics.ARCADE);
        squirrels.enableBody = true;
        squirrels.physicsBodyType = Phaser.Physics.ARCADE;
        squirrels.physicsBodyType.immovable = true; 
        squirrels.body.collideWorldBounds = true;
        squirrels.body.customSeparateX = true;
        squirrels.body.customSeparateY = true;
        
        s1 = game.add.sprite(game.world.randomX, game.world.randomY, 'squirrel');
        game.physics.enable(s1, Phaser.Physics.ARCADE);
        s1.enableBody = true;
        s1.physicsBodyType = Phaser.Physics.ARCADE;
        s1.physicsBodyType.immovable = true; 
        s1.body.collideWorldBounds = true;
        s1.body.customSeparateX = true;
        s1.body.customSeparateY = true;
    
        s2 = game.add.sprite(game.world.randomX, game.world.randomY, 'squirrel');
        game.physics.enable(s2, Phaser.Physics.ARCADE);
        s2.enableBody = true;
        s2.physicsBodyType = Phaser.Physics.ARCADE;
        s2.physicsBodyType.immovable = true; 
        s2.body.collideWorldBounds = true;
        s2.body.customSeparateX = true;
        s2.body.customSeparateY = true;
    
        s3 = game.add.sprite(game.world.randomX, game.world.randomY, 'squirrel');
        game.physics.enable(s3, Phaser.Physics.ARCADE);
        s3.enableBody = true;
        s3.physicsBodyType = Phaser.Physics.ARCADE;
        s3.physicsBodyType.immovable = true; 
        s3.body.collideWorldBounds = true;
        s3.body.customSeparateX = true;
        s3.body.customSeparateY = true;
    
        s4 = game.add.sprite(game.world.randomX, game.world.randomY, 'squirrel');
        game.physics.enable(s4, Phaser.Physics.ARCADE);
        s4.enableBody = true;
        s4.physicsBodyType = Phaser.Physics.ARCADE;
        s4.physicsBodyType.immovable = true; 
        s4.body.collideWorldBounds = true;
        s4.body.customSeparateX = true;
        s4.body.customSeparateY = true;
    
        s5 = game.add.sprite(game.world.randomX, game.world.randomY, 'squirrel');
        game.physics.enable(s5, Phaser.Physics.ARCADE);
        s5.enableBody = true;
        s5.physicsBodyType = Phaser.Physics.ARCADE;
        s5.physicsBodyType.immovable = true; 
        s5.body.collideWorldBounds = true;
        s5.body.customSeparateX = true;
        s5.body.customSeparateY = true;
//    }
>>>>>>> origin/master
    
    //collision test//
    bullets = game.add.group();
    bullets.enableBody = true;
    bullets.physicsBodyType = Phaser.Physics.ARCADE;
    bullets.createMultiple(100, 'acorn');
    bullets.setAll('checkWorldBounds', true);
    bullets.setAll('outOfBoundsKill', true);
    
    player = game.add.sprite(600, 600, 'dude');
    player.anchor.set(0.5);
    player.body.bounce.y = 0.1;                                          
    // add bounce to player
    player.body.gravity.y = 600;                                         // set player gravity
    player.body.collideWorldBounds = true;                               // whether player should collide with world boundary or not
    player.body.immovable = true;
    player.body.allowRotation = false;
    player.animations.add('left', [0, 1, 2, 3], 10, true);// player animation frame when player walks left
    player.animations.add('right', [5, 6, 7, 8], 10, true);    
    star = game.add.image(300, 300, 'cup');
    star.enableBody = true;
    star.physicsBodyType = Phaser.Physics.ARCADE;
}
    

function update() {
 //player.rotation += 0.01;
 //player.rotation = game.physics.arcade.angleToPointer(player);

    if (game.input.activePointer.isDown){
        fire();
    }
    
<<<<<<< HEAD
    game.physics.arcade.overlap(bullets, squirrels, collisionHandler, null, this); 
    // if bombs overlap with player then call bombHitsPlayer function

    game.physics.arcade.overlap(star, squirrels, cupCollision, null, this);
    
  

=======
    game.physics.arcade.overlap(bullets,squirrels,collisionHandler, null, this);      // if bombs overlap with player then call bombHitsPlayer function
    game.physics.arcade.overlap(bullets,s1,collisionHandler, null, this);
    game.physics.arcade.overlap(bullets,s2,collisionHandler, null, this);
    game.physics.arcade.overlap(bullets,s3,collisionHandler, null, this);
    game.physics.arcade.overlap(bullets,s4,collisionHandler, null, this);
    game.physics.arcade.overlap(bullets,s5,collisionHandler, null, this);

    game.physics.arcade.overlap(squirrels, star, cupCollision, null, this);

//    game.physics.arcade.overlap(bullets, squirrels, collisionHandler, null, this);      // if bombs overlap with player then call bombHitsPlayer function
>>>>>>> origin/master
}
    

    

function fire() {
<<<<<<< HEAD

    if (game.time.now > nextFire && bullets.countDead() > 0)
    {
        nextFire = game.time.now + fireRate;
        var bullet = bullets.getFirstDead();
        bullet.reset(player.x + 100, player.y + 30);
        game.physics.arcade.moveToPointer(bullet, 350);   
=======
    if (game.time.now > nextFire && bullets.countDead() > 0)
    {
        bullet = bullets.getFirstExists(false);
        if (bullet) {
            nextFire = game.time.now + fireRate;
            bullet.reset(player.x - 100, player.y - 65);
            game.physics.arcade.moveToPointer(bullet, 350);  
        } 
>>>>>>> origin/master
    }
}
    
 

function render() {
	for (var i = 0; i < totalSquirrels; i++ ) {
		game.debug.body(squirrels.children[i]);
	}
//     game.debug.text('Active Bullets: ' + bullets.countLiving() + ' / ' + bullets.total, 32, 32);
//     game.debug.spriteInfo(player, 32, 450);
//     game.debug.spriteInfo(star, 32, 450); 
}

function processHandler (bullets, squirrels) {
    return true;
}

<<<<<<< HEAD
function collisionHandler (squirrels, bullets) {
        squirrels.kill();
        
        score += 10;
        scoreText.text = 'Score:' + score;
        
}
    
function cupCollision (cup, squirrels) {
    cup.kill()
    score -= 5
    scoreText.text = 'Score:' + score;
    squirrels.respawn()
}

=======
function collisionHandler (s, bullets) {
    if (s.exists) {
        bullets.kill();
        s.kill();
        totalSquirrels--;
    }
}
    
function cupCollision (squirrels, star) {
    star.kill();
}
>>>>>>> origin/master
</script>

</body>
</html>